@model RepositorioClases.Events

@{
    ViewBag.Title = "Eventos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>Nuevo Evento</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            
            <div class="md-form">
                @Html.EditorFor(model => model.NombreEvento, new { htmlAttributes = new { @class = "form-control" } })
                @Html.LabelFor(model => model.NombreEvento)
                @Html.ValidationMessageFor(model => model.NombreEvento, "", new { @class = "text-danger" })
            </div>

            <div class="md-form">
                @Html.EditorFor(model => model.Descripcion, new { htmlAttributes = new { @class = "form-control" } })
                @Html.LabelFor(model => model.Descripcion)
                @Html.ValidationMessageFor(model => model.Descripcion, "", new { @class = "text-danger" })
            </div>

        <div class="md-form">
            @Html.EditorFor(model => model.Direccion, new { htmlAttributes = new { @class = "form-control" } })
            @Html.LabelFor(model => model.Direccion)
            @Html.ValidationMessageFor(model => model.Direccion, "", new { @class = "text-danger" })
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.FechaInicio, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.FechaInicio, new { htmlAttributes = new { @class = "form-control", type = "date" } })
                @Html.ValidationMessageFor(model => model.FechaInicio, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.FechaFin, htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.FechaFin, new { htmlAttributes = new { @class = "form-control", type = "date" } })
                @Html.ValidationMessageFor(model => model.FechaFin, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="form-group">
            @Html.EnumDropDownListFor(model => model.IdCategoria, htmlAttributes: new { @class = "form-control"})
            @Html.ValidationMessageFor(model => model.IdCategoria, "", new { @class = "text-danger" })
        </div>

        <div class="form-group">
            <div class="col-md-10">
                @Html.CheckBoxFor(model => model.Destacado, new { htmlAttributes = new { @class = "form-control" } })
                @Html.LabelFor(model => model.Destacado, htmlAttributes: new { @class = "control-label col-md-2" })
            </div>
        </div>

        <div id="map" style="width:100%;height:600px;"></div>

        <script>
            // Note: This example requires that you consent to location sharing when
            // prompted by your browser. If you see the error "The Geolocation service
            // failed.", it means you probably did not give permission for the browser to
            // locate you.

            function initMap() {

                var map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: -30.94520, lng: -61.56056 },
                    zoom: 15
                });

                var infoWindow = new google.maps.InfoWindow({ map: map });


                var myMarker = new google.maps.Marker({
                    position: new google.maps.LatLng(-30.94520, -61.56056),
                    draggable: true
                });

                map.setCenter(myMarker.position);
                myMarker.setMap(map);

                $('#lat').val(-30.94520);
                $('#lng').val(-61.56056);

                //-----------------------------------------------------------------------


                google.maps.event.addListener(myMarker, 'dragend', function (evt) {
                    $('#lat').val(evt.latLng.lat().toFixed(5));
                    $('#lng').val(evt.latLng.lng().toFixed(5));
                });

                google.maps.event.addListener(myMarker, 'dragstart', function (evt) {
                    document.getElementById('lat').innerHTML = 'Currently dragging marker...';
                });

                //-----------------------------------------------------------------------
            }
            function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                infoWindow.setPosition(pos);
                infoWindow.setContent(browserHasGeolocation ?
                    'Error: The Geolocation service failed.' :
                    'Error: Your browser doesn\'t support geolocation.');
            }

        </script>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPHbsGCp8vpDA1vMKAFWsU0Odc8Mz5SAA&callback=initMap" async defer></script>

        <div class="md-form col-md-2">
            @Html.EditorFor(model => model.lat, new { htmlAttributes = new { @class = "form-control", @id = "lat", @readonly = "readonly", @hidden =true } })
            @Html.ValidationMessageFor(model => model.lat, "", new { @class = "text-danger" })
        </div>
        <h3>Arrastre el marcador hacia la ubicación del evento</h3>

        <div class="md-form col-md-2">
            @Html.EditorFor(model => model.lng, new { htmlAttributes = new { @class = "form-control", @id = "lng", @readonly = "readonly", @hidden = true } })
            @Html.ValidationMessageFor(model => model.lng, "", new { @class = "text-danger" })
        </div>


        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>